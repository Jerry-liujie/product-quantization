# hpc3.cse.cuhk.edu.hk:/research/jcheng2/xinyan/github/product-quantization> python run_imi_iregualr_rq.py
# Parameters: dataset = imagenet, topK = 1000, Ks = 256, metric = euclid
# load the base data data/imagenet/imagenet_base.fvecs,
# load the queries data/imagenet/imagenet_query.fvecs,
# load the ground truth data/imagenet/1000_imagenet_euclid_groundtruth.ivecs
#    Training the subspace: 0 / 2, 0 -> 75
#    Training the subspace: 1 / 2, 75 -> 150
# compress items with imi
# train hierarchy rqs on residuals
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 0,  residual average norm : 0.17014269530773163 max norm: 0.7457097172737122 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 1,  residual average norm : 0.1564449816942215 max norm: 0.6490245461463928 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 2,  residual average norm : 0.14641572535037994 max norm: 0.5686091780662537 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 3,  residual average norm : 0.138215571641922 max norm: 0.5174157619476318 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 4,  residual average norm : 0.1313132494688034 max norm: 0.47736719250679016 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 5,  residual average norm : 0.12516379356384277 max norm: 0.4601731598377228 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 6,  residual average norm : 0.11969298124313354 max norm: 0.4310767948627472 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 0,  residual average norm : 0.17028144001960754 max norm: 0.7275429964065552 min norm: 0.0
#    Training the subspace: 0 / 1, 0 -> 150
# layer: 1,  residual average norm : 0.15660572052001953 max norm: 0.6438684463500977 min norm: 0.0
# compress items with rq
# compress norm
#    Training the subspace: 0 / 1, 0 -> 1
#    Training the subspace: 0 / 1, 0 -> 1
# imi full sort and generate candidate
# probe

# probe 16 items
# hierarchy_index [ 0  3 16]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
   16,    1,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,  0.2000,
   16,   10,  0.0225,  0.0265,  0.0295,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,  0.0300,
   16,   20,  0.0123,  0.0155,  0.0185,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,  0.0195,
   16,   50,  0.0057,  0.0077,  0.0099,  0.0110,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,
   16,  100,  0.0035,  0.0049,  0.0065,  0.0072,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,
   16, 1000,  0.0006,  0.0009,  0.0014,  0.0019,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,  0.0022,

# probe 256 items
# hierarchy_index [  0  51 256]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
  256,    1,  0.7900,  0.8050,  0.8050,  0.8150,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,  0.8200,
  256,   10,  0.0820,  0.0945,  0.1110,  0.1300,  0.1495,  0.1660,  0.1735,  0.1765,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,  0.1780,
  256,   20,  0.0412,  0.0490,  0.0608,  0.0767,  0.0940,  0.1120,  0.1210,  0.1258,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,  0.1273,
  256,   50,  0.0170,  0.0221,  0.0289,  0.0393,  0.0520,  0.0686,  0.0819,  0.0879,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,  0.0893,
  256,  100,  0.0086,  0.0117,  0.0164,  0.0238,  0.0339,  0.0470,  0.0597,  0.0665,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,  0.0680,
  256, 1000,  0.0009,  0.0015,  0.0026,  0.0045,  0.0080,  0.0132,  0.0203,  0.0270,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,  0.0295,

# probe 1024 items
# hierarchy_index [   0  204 1024]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
 1024,    1,  0.8850,  0.9300,  0.9400,  0.9450,  0.9500,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,  0.9650,
 1024,   10,  0.0890,  0.1135,  0.1345,  0.1665,  0.2045,  0.2475,  0.2930,  0.3365,  0.3525,  0.3590,  0.3590,  0.3590,  0.3590,  0.3590,  0.3590,  0.3590,  0.3590,  0.3590,
 1024,   20,  0.0447,  0.0608,  0.0757,  0.0985,  0.1295,  0.1670,  0.2087,  0.2520,  0.2735,  0.2838,  0.2843,  0.2843,  0.2843,  0.2843,  0.2843,  0.2843,  0.2843,  0.2843,
 1024,   50,  0.0182,  0.0258,  0.0349,  0.0501,  0.0717,  0.1013,  0.1410,  0.1842,  0.2139,  0.2248,  0.2257,  0.2257,  0.2257,  0.2257,  0.2257,  0.2257,  0.2257,  0.2257,
 1024,  100,  0.0091,  0.0135,  0.0193,  0.0302,  0.0456,  0.0703,  0.1041,  0.1436,  0.1764,  0.1903,  0.1918,  0.1918,  0.1918,  0.1918,  0.1918,  0.1918,  0.1918,  0.1918,
 1024, 1000,  0.0010,  0.0016,  0.0028,  0.0050,  0.0090,  0.0163,  0.0285,  0.0472,  0.0711,  0.0921,  0.0976,  0.0976,  0.0976,  0.0976,  0.0976,  0.0976,  0.0976,  0.0976,

# probe 4096 items
# hierarchy_index [   0  819 4096]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
 4096,    1,  0.9500,  0.9500,  0.9500,  0.9550,  0.9600,  0.9650,  0.9800,  0.9800,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,  0.9900,
 4096,   10,  0.0950,  0.1235,  0.1575,  0.2005,  0.2570,  0.3265,  0.4030,  0.4855,  0.5485,  0.5910,  0.6140,  0.6180,  0.6180,  0.6180,  0.6180,  0.6180,  0.6180,  0.6180,
 4096,   20,  0.0478,  0.0658,  0.0890,  0.1220,  0.1680,  0.2253,  0.2987,  0.3822,  0.4565,  0.5112,  0.5440,  0.5530,  0.5533,  0.5533,  0.5533,  0.5533,  0.5533,  0.5533,
 4096,   50,  0.0193,  0.0281,  0.0414,  0.0638,  0.0944,  0.1392,  0.2023,  0.2830,  0.3622,  0.4299,  0.4687,  0.4802,  0.4813,  0.4813,  0.4813,  0.4813,  0.4813,  0.4813,
 4096,  100,  0.0097,  0.0146,  0.0225,  0.0366,  0.0586,  0.0932,  0.1432,  0.2147,  0.2933,  0.3678,  0.4170,  0.4330,  0.4345,  0.4345,  0.4345,  0.4345,  0.4345,  0.4345,
 4096, 1000,  0.0010,  0.0017,  0.0030,  0.0054,  0.0102,  0.0185,  0.0333,  0.0588,  0.0995,  0.1574,  0.2220,  0.2655,  0.2722,  0.2722,  0.2722,  0.2722,  0.2722,  0.2722,

# probe 16384 items
# hierarchy_index [    0  3276 16384]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
16384,    1,  0.9550,  0.9700,  0.9750,  0.9750,  0.9750,  0.9850,  0.9850,  0.9850,  0.9850,  0.9850,  0.9950,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
16384,   10,  0.0955,  0.1325,  0.1865,  0.2470,  0.3195,  0.4015,  0.4970,  0.6000,  0.6840,  0.7555,  0.8085,  0.8425,  0.8570,  0.8585,  0.8585,  0.8585,  0.8585,  0.8585,
16384,   20,  0.0480,  0.0698,  0.1040,  0.1482,  0.2095,  0.2860,  0.3855,  0.4942,  0.5968,  0.6878,  0.7548,  0.8057,  0.8283,  0.8310,  0.8310,  0.8310,  0.8310,  0.8310,
16384,   50,  0.0192,  0.0297,  0.0486,  0.0749,  0.1156,  0.1764,  0.2609,  0.3668,  0.4838,  0.5948,  0.6833,  0.7455,  0.7756,  0.7825,  0.7828,  0.7828,  0.7828,  0.7828,
16384,  100,  0.0097,  0.0157,  0.0265,  0.0428,  0.0711,  0.1162,  0.1814,  0.2759,  0.3933,  0.5158,  0.6229,  0.6990,  0.7394,  0.7505,  0.7508,  0.7508,  0.7508,  0.7508,
16384, 1000,  0.0010,  0.0018,  0.0033,  0.0061,  0.0113,  0.0209,  0.0381,  0.0683,  0.1188,  0.1988,  0.3097,  0.4358,  0.5407,  0.5867,  0.5902,  0.5902,  0.5902,  0.5902,

# probe 65536 items
# hierarchy_index [    0 13107 65536]
Probe, top-K, 00001.,  00002.,  00004.,  00008.,  00016.,  00032.,  00064.,  00128.,  00256.,  00512.,  01024.,  02048.,  04096.,  08192.,  16384.,  32768.,  65536.,  131072.,
65536,    1,  0.9700,  0.9750,  0.9800,  0.9800,  0.9900,  0.9900,  0.9900,  0.9950,  0.9950,  0.9950,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
65536,   10,  0.0970,  0.1410,  0.2050,  0.2815,  0.3735,  0.4895,  0.5950,  0.7090,  0.8020,  0.8625,  0.9160,  0.9510,  0.9665,  0.9805,  0.9840,  0.9840,  0.9840,  0.9840,
65536,   20,  0.0488,  0.0750,  0.1155,  0.1745,  0.2477,  0.3585,  0.4778,  0.6082,  0.7198,  0.8070,  0.8785,  0.9290,  0.9533,  0.9708,  0.9773,  0.9775,  0.9775,  0.9775,
65536,   50,  0.0196,  0.0317,  0.0542,  0.0878,  0.1397,  0.2198,  0.3288,  0.4566,  0.5922,  0.7091,  0.8097,  0.8812,  0.9259,  0.9535,  0.9626,  0.9636,  0.9637,  0.9637,
65536,  100,  0.0099,  0.0168,  0.0303,  0.0511,  0.0859,  0.1437,  0.2295,  0.3470,  0.4872,  0.6255,  0.7480,  0.8395,  0.9023,  0.9393,  0.9524,  0.9544,  0.9545,  0.9545,
65536, 1000,  0.0010,  0.0019,  0.0036,  0.0068,  0.0128,  0.0240,  0.0442,  0.0806,  0.1417,  0.2379,  0.3759,  0.5377,  0.6938,  0.8138,  0.8769,  0.8940,  0.8948,  0.8948,
